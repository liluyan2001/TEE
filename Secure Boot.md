# Secure Boot and Remote Attestation in the Sanctum Processor

> 执行处理器不需要从厂商那里获得分配的密钥，而是通过physical unclonable Function （PUF）那里获得私钥



## PUF生成唯一且不可复制密钥的

PUF（物理不可克隆函数）生成唯一且不可复制密钥的过程利用了芯片在制造过程中产生的物理特性差异。这些差异是由制造过程中微小的、不可预测的偏差引起的，因此即使是同一批次生产的芯片，其物理特性也会有所不同。这使得每个芯片都具备独特的硬件“指纹”，这种“指纹”可以用来生成唯一的加密密钥。

在论文中，PUF生成密钥的具体过程主要包括以下几个步骤：

1. **制造过程中的物理变异**：PUF利用了芯片制造过程中产生的随机物理变异。例如，芯片中电路的延迟、振荡器频率等都会因为制造工艺的微小差异而不同，这些差异无法被复制或预测。

2. **PUF输出密钥种子**：在芯片上，有多个振荡器对组成的PUF结构。这些振荡器对会在每次启动时被激活，它们之间的频率差异会被测量并生成一个唯一的位串。这个位串相当于密钥的“原材料”，也就是PUF的初始输出。

3. **误差校正和安全提取**：由于PUF输出具有一定的噪声，即使同一个芯片在不同时间测量时，可能会出现少量比特错误。为了保证生成的密钥稳定可靠，PUF系统会使用一种称为“模糊提取器”（Fuzzy Extractor）的技术对这些噪声进行纠正。论文中提到使用了“带有后门的计算模糊提取器”（trapdoor computational fuzzy extractor），通过选择高置信度的振荡器对，来生成稳定的、可重复的密钥种子。

4. **密钥对生成**：在PUF输出被纠正为一个稳定的比特串后，这个比特串会被用作密钥生成的种子。具体来说，这个比特串会经过椭圆曲线密钥生成算法（如Ed25519）来生成公钥-私钥对。

5. **私钥销毁**：生成的私钥仅用于签名启动映像或认证请求，并在使用后立即销毁，确保该私钥不会长期存储在芯片中，进一步提高了系统的安全性。

这个过程确保每个芯片都有一个唯一的、不可复制的密钥，而该密钥仅能在芯片启动时动态生成，不依赖于外部存储。这种方法使得即便制造商对芯片有物理访问权限，他们也无法获取或复制密钥，满足了隐私和安全性要求。

## Secret  Boot

​	为了建立可信的程序执行环境，主机系统必须首先启动到可验证的状态。如果启动过程中的某一步骤没有包含在对客户端的证明中，那么它的状态就无法得到保证，并有可能危及随后加载程序的隐私或完整性。受信任的引导加载程序通常是这一过程中的第一个组件，被认为是引导过程的信任根。它是系统初始化后运行的第一个代码，负责在本地或利用 TPM 等可信硬件检查后续组件的测量和/或签名。

​	**受信任的引导加载程序通常是此过程中的第一个组件，被视为引导过程的信任根**。它是系统初始化时运行的第一个代码，负责在本地或利用受信任的硬件（如 TPM）检查后续组件的测量值和/或签名。

​	Heads [24] 实现了由 TPM 支持的测量启动过程，其中启动过程的信任根是写保护 ROM，而身份验证和证明的信任根是 TPM。ARM 的 TrustZone 没有提供远程证明的规范机制，但其安全世界中的软件能够实现自己的证明。 英特尔的安全启动具有测量和验证两种模式。 对于这两种模式，CPU 上的微代码都是启动过程的信任根 [35]。在测量模式下，TPM 负责存储和证明测量值，而在验证模式下，每个组件都由制造商签名，并且在加载组件之前验证这些签名。 相比之下，SGX 并不关心系统的一般启动过程，而只关注使用存储在处理器上的密钥为启动后的 enclave 提供证明和身份验证 [4]、[32]。

## 做了什么

​	我们以 RISC-V Rocket 芯片架构 [27] 为基础，设计、记录并实现了一种无需制造商明确分配私钥的验证执行处理器。取而代之的是，该处理器通过 PUF 测得的制造差异获得其加密身份。由处理器内置引导加载器执行的软件将 PUF 输出转换成椭圆曲线密钥对，其中的公开部分由制造商使用其私人密钥签名。由于重新生成的 PUF 输出需要纠错，我们采用了陷阱门计算模糊提取器 [20] 来确保纠错的安全性。重新生成的私钥用于签署引导映像的可信部分，并立即销毁。

## 可信秘钥生成

​	英特尔 Skylake（包含 SGX）和 ARM 的安全处理器产品（基于 TrustZone）等商用安全处理器似乎使用某种形式的非易失性存储器（non-volatile memory）来存储密钥。